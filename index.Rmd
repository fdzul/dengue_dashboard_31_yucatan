---
title: "Programa de Prevención y Control del Dengue de Yucatán"
output: 
  flexdashboard::flex_dashboard:
      theme: flatly
output_dir: libs
cover-image: images/cover.jpg
---

```{r setup}
# Step 1. load the librarys ####
options(shiny.maxRequestSize=30*1024^2)
library(formattable)
library(tmap)
library(rmarkdown)
library(knitr)
library(shiny)
library(flexdashboard)
library(plotly)
library(boldenr)
library(magrittr)
library(leaflet)
library(ggplot2)
library(dplyr)
library(stringr)
library(dash)
library(ECharts2Shiny)
library(sf)

# Step 2. define the path ####

if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    # 2.1 dengue dataset
    path_arbo <- "/Users/fdzul/Library/CloudStorage/OneDrive-Personal/datasets/DGE/arbo/"
    
    # 2.2 vector control dataset 
    path_vect <- "/Users/fdzul/Library/CloudStorage/OneDrive-Personal/datasets/CENAPRECE/2023/31_yucatan"
    path_coord <- paste(path_vect, "DescargaOvitrampasMesFco.txt", sep = "/")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    # 2.1. dengue dataset
    path_arbo <- "D:/OneDrive/datasets/DGE/arbo/"
    
    # 2.2 vector control dataset 
    path_vect <- "D:/OneDrive/datasets/CENAPRECE/2023/31_yucatan"
    path_coord <- paste(path_vect, "DescargaOvitrampasMesFco.txt", sep = "/")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}



# Step 3. load the functions ####
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    # .1 dengue dataset
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_confirmados.R")
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_hospitalizados.R")
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/static_bump_map.R")
  source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/boldenr/heatmap_dengue.R")
    
    
    # 1.3 ovitraps dataset 
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/ovitraps_occupancy_abundancy.R")

    # 1.4 larvae control dataset
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/cl_interactive_map.R")
    
    # 1.5 ulv dataset
    
    # 1.6 hotspots
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/risk_agebs.R")
    
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/risk_map.R")
    
    source("~/Dropbox/r_developments/r_new_functions/3.Functions/hotspots_map.R")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    # 1.1. dengue dataset
    
    # load the heatmap confirmados y hospitalizados function
    source('C:/Users/HOME/Dropbox/r_developments/r_dashboards/github_pages/test_dashboard/3.Functions/heatmap_confirmados.R')
    source("C:/Users/HOME/Dropbox/r_developments/r_dashboards/github_pages/test_denv_dash_yuc/functions/heatmap_hospitalizados.R")
    source("C:/Users/HOME/Dropbox/r_developments/r_new_functions/3.Functions/static_bump_map.R")
    
    # 1.3 ovitraps dataset 
    source("C:/Users/HOME/Dropbox/r_developments/r_new_functions/3.Functions/ovitraps_occupancy_abundancy.R")
    
    # 1.4 larvae control dataset
     source("C:/Users/HOME//Dropbox/r_developments/r_new_functions/3.Functions/cl_interactive_map.R")
    
    # 1.5 ulv dataset
    
    # 1.6 hotspots
    source("C:/Users/HOME/Dropbox/r_developments/r_dashboards/github_pages/test_dashboard/3.Functions/cl_interactive_map.R")

    #Step  load the risk_ageb function ###
    source('C:/Users/HOME/Dropbox/r_developments/r_dashboards/github_pages/test_dashboard/3.Functions/risk_agebs.R')

    # Step  load the risk_map function ####
    source("D:/OneDrive/proyects/hotspots/3.Functions/risk_map.R")

    # Step  load the hotspots map ####
    source("C:/Users/HOME/Dropbox/r_developments/r_dashboards/github_pages/test_dashboard/3.Functions/hotspots_map.R")
    

    # 1.5 ulv dataset
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}





# Step 3. Load the dataset ####

# 3.1 arbovirosis dataset
x <- boldenr::read_dataset_bol(path = path_arbo,
                                dataset = "sinave")
# 3.2. ovitrap dataset 

ovis <- boldenr::read_dataset_bol(path = path_vect,
                                 dataset = "vectores",
                                 inf = "Lecturas")

# 3.3  larvae control dataset
cl <- boldenr::read_dataset_bol(path = path_vect, 
                                dataset = "vectores",
                                inf = "Control") |>
    dplyr::mutate(cve_geo = paste(cve_ent, cve_mpo, 
                                  #cve_loc, # 423522
                                  sector, 
                                  Manzana, sep = ""))

# 3.4 ulv dataset 
neb <- boldenr::read_dataset_bol(path = path_vect, 
                                 dataset = "vectores",
                                 inf = "Nebulizacion")



# Step 5. Load the RData files ####
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    # load the blocks
    load("~/OneDrive/automatic_read_ine_2010/8.RData/block_ine10_mx.RData")
    
    # load the dengue cases hotspots
    load("~/Dropbox/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
    cases_hotspots_agebs19 <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
    
    # data for epichannel data
    load("~/OneDrive/automatic_read_sinave/8.RData/epid_channel_data_js.RData")
    load("~/OneDrive/proyects/geocoding_mex/2022/9.RData_geocoded/den2022_positivos.RData")
    load("~/OneDrive/proyects/geocoding_mex/2022/9.RData_geocoded/den2022_positivos.RData")
    
    # load the vector hotspots
    load("~/OneDrive/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    
    # load the blocks #####
    load("D:/OneDrive/automatic_read_ine_2010/8.RData/block_ine10_mx.RData") 
    
    # Step 1. load the hotspots dengue cases ####
    # Step 1. load the hotspots dengue cases ####
   load("E:/backup/Dropbox_respaldo_2023_01_03/hotspots_2022/8.RData/cases_hotspots_agebs19.RData")
    
    cases_hotspots_agebs19 <- cases_hotspots_agebs19 |>
    sf::st_make_valid()
    
    # data for epichannel data
    load("D:/OneDrive/automatic_read_sinave/8.RData/epid_channel_data_js.RData")
    
    # dengue dataaset geocoded
    load("D:/OneDrive/proyects/geocoding_mex/2022/9.RData_geocoded/den2023_positivos.RData")
    load("D:/OneDrive/proyects/geocoding_mex/2022/9.RData_geocoded/den_31_yucatan_2022.RData")
    
    # load the vector hotspots
    load("D:/OneDrive/proyects/hotspots_eggs/8.RData/31_yucatan/betas/31_yucatan_zinb1_betas.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}


# 


# Step 6. define the functions ####

# Step 5.2 define the function for eggs intensity 
intensity_function <- function(x){
    y <- x |>
        dplyr::mutate(hotspots_binary = ifelse(hotspots == "Hotspots", 1, 0)) |>
        as.data.frame() |>
        dplyr::select(x, y, week, hotspots_binary) |>
        tidyr::pivot_wider(id_cols = c(x, y),
                           names_from = "week",
                           #names_prefix = "hotspots",
                           values_from = "hotspots_binary") |>
        as.data.frame() 
    
    y$intensity <- rowSums(y |> dplyr::select(-1, -2))
    y$per_intensity <- round((y$intensity/ncol(y |> dplyr::select(-1, -2, -intensity)))*100,digits = 1)
    y |> dplyr::select(x, y, intensity,per_intensity)
}



# Step 7. load the blocks ine 2020 ####
blocks_ine <- rgeomex::blocks_ine20_mx_e |>
    dplyr::filter(entidad == "31")


# Step 3. load the AGEM inegi 2019 
mpo_inegi <- rgeomex::AGEM_inegi19_mx[, c("CVE_MUN", "geometry")] 

# Step 4. spatial joint for add the CVE_MUN to ine blocks 2020 
 blocks_ine <- sf::st_join(x = blocks_ine,
                           y = mpo_inegi) |>
    dplyr::mutate(cve_geo = paste(stringr::str_pad(entidad, pad = "0", width = 2, side = "left"),
                                  stringr::str_pad(CVE_MUN, pad = "0", width = 3, side = "left"),
                                  #stringr::str_pad(localidad, pad = "0", width = 4, side = "left"),
                                  stringr::str_pad(seccion, pad = "0", width = 4, side = "left"),
                                  stringr::str_pad(manzana, pad = "0", width = 4, side = "left"),
                                  sep = "")) 

# Step 5. left joint control larvario and blocks ine 2020 datasets 
control_larvario_blocks <- dplyr::left_join(x = blocks_ine  |>
                                                dplyr::select(geometry, cve_geo, CVE_MUN),
                      y = cl,
                      by  = "cve_geo") |>
    dplyr::filter(!is.na(cve_ent))  |>
    dplyr::mutate(coverage = dplyr::case_when(Cobertura.en.Manzana < 51 ~ "Deficiente",
                                              Cobertura.en.Manzana >= 51 & Cobertura.en.Manzana < 70 ~ "Regular",
                                              Cobertura.en.Manzana >= 70 & Cobertura.en.Manzana < 85 ~ "Bueno",
                                              Cobertura.en.Manzana >= 85 ~ "Óptimo",
                                              T ~ "NA")) |>
    dplyr::mutate(coverage =  factor(coverage,
                                     levels = c("Bueno","Deficiente","Óptimo","Regular")[c(3, 1, 4, 2)],
                                     labels = c("Bueno","Deficiente","Óptimo","Regular")[c(3, 1, 4, 2)]))




# load the larvae control ####
cl <- boldenr::read_dataset_bol(path = path_vect, 
                                dataset = "vectores",
                                inf = "Control")
```

# **Vigilancia Epidemiológica**

## Column {.tabset}

### **Situación Epidemiologica Nacional**

<html>
<head>
<style>
</style>
</head>
<body>
<div >
  <h2></h2>
  <p></p>

<div style = "display: grid; width: 1px; grid-template-columns: 700px 700px; align-items: start; justify-content: space-between;">
#### **<span style="color:blue"> Treemap de casos confirmados </span>**
```{r treemap_national, out.width="100%", out.height="100%"}
x  |>
    dplyr::filter(ANO == 2023)  |>
    dplyr::filter(!DES_EDO_RES %in% c("OTROS PAISES", 
                                      "OTROS PAISES DE LATINOAMERICA",
                                      "ESTADOS UNIDOS DE NORTEAMERICA"))  |>
    dplyr::filter(DES_DIAG_FINAL %in% 
                      c("DENGUE CON SIGNOS DE ALARMA", "DENGUE NO GRAVE", 
                        "DENGUE GRAVE"))  |>
    dplyr::group_by(DES_EDO_RES,DES_DIAG_FINAL)  |>
    dplyr::summarise(value = dplyr::n(), 
                     .groups = "drop")  |>
    dplyr::mutate(DES_EDO_RES = stringr::str_to_title(DES_EDO_RES),
                  DES_DIAG_FINAL = stringr::str_to_title(DES_DIAG_FINAL))  |>
    dplyr::mutate(DES_DIAG_FINAL = factor(DES_DIAG_FINAL,
                                          levels = c("Dengue Con Signos De Alarma",
                                                     "Dengue Grave",
                                                     "Dengue No Grave"),
                                          labels = c("DSA", "DG", "DNG")))  |>
    ggplot2::ggplot(ggplot2::aes(area = value, 
                                 fill = DES_EDO_RES,
                                 subgroup = DES_EDO_RES,
                                 label = DES_DIAG_FINAL)) +
    treemapify::geom_treemap() +
    treemapify::geom_treemap_text(fontface = "italic", 
                                  colour = "black", 
                                  place = "bottom",
                                  #alpha = 0.5,
                                  grow = F) +
    treemapify::geom_treemap_subgroup_text(place = "middle", 
                                           colour = "White", 
                                           #alpha = 0.8, 
                                           grow = T)+
    ggplot2::theme(legend.position = "none") +
    ggplot2::scale_fill_viridis_d()
```

<div>
#### **<span style="color:blue"> Casos confirmados y serotipos </span>**

```{r casos_serotipos,out.width="100%", out.height="100%"}
library(magrittr)
boldenr::plot_state_serotype(dataset = x, 
                                  year = 2023, 
                                  x_serotype  = 0.5, 
                                  y_serotype = 0.17, 
                                  scale_serotype = 1.7)
```
</div>

</div>


#### **<span style="color:blue"> Casos Confirmados por Estado </span>**

```{r heatmap_confirmados_state}
heatmap_confirmados(dataset = x, 
                    year = 2023, 
                    size_text = 3, 
                    EDO = TRUE)
```

#### **<span style="color:blue"> Casos Confirmados por Estado </span>**
```{r bumpmap_national_2023, out.width="100%", out.height="100%"}
library(dplyr)
static_bump_map(dataset = x,
                year = "2023",
                state = TRUE,
                size_text_value = 2,
                size_text = 2,
                country_text_x = 0.5,
                country_text_y = 0.8,
                line_size = 1.5,
                pal_vir = "viridis")
```


#### **<span style="color:blue"> Casos Confirmados por Municipio </span>**
```{r heatmap_confirmados_mun}
heatmap_dengue(dataset = x,
               state = NULL,
               year = "2023",
               hospitalizados = FALSE,
               status = 2)
```


#### **<span style="color:blue"> Casos Hospitalizados por Municipio </span>**
```{r heatmap_hospitalizados_mun}
heatmap_dengue(dataset = x,
               state = NULL,
               year = "2023",
               hospitalizados = TRUE)
```



#### **<span style="color:blue"> Canal Epidemiológico por Estado </span>**

```{r epidemiological_channel_by_state}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/boldenr/epidemiological_channel.R")
epidemiological_channel(data = x)
```

</div>
</body>
</html>


### [**Distribución del Dengue**]{style="color:#990000"}

```{r distribucion_dengue}
if(as.vector(Sys.info()["sysname"]) == "Darwin"){
    load("~/Library/CloudStorage/OneDrive-Personal/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")
    
} else if(as.vector(Sys.info()["sysname"]) == "Windows"){
    load("D:/OneDrive/proyects/geocoding_mex/2023/9.geocoded_dataset/dengue_mx_2023.RData")

} else if(as.vector(Sys.info()["sysname"]) == "Linux"){
    
}

#
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/boldenr/distribution_maps.R")

#
distribution_dengue(geocoded_dataset = z,
                    country = FALSE,
                    state = "31")


```



### [**Casos Confirmados por JS & Municipio** ]{style="color:#7d9029"}

<html>
<head>

```{=html}
<style>
.myDiv1 {
  border: 2px outset darkgreen;
  background-color: darkgreen;
  text-align: center;
}
</style>
```
</head>

<body>

::: myDiv1
<h2>

</h2>

<p>

</p>

#### [**Casos Por Municipio 2022** ]{style="color:#7d9029"}
```{r bump_map_mun_2022}
static_bump_map(dataset = x,
                year = "2022",
                state = FALSE,
                cve_edo = "31",
                country_text_x = .01,
                country_text_y = 0.024,
                axis_start = 1,
                value_text = 0.37,
                size_text_value = 4,
                line_size = 2,
                size_text_country = 4,
                pal_vir = "viridis") +
    ggplot2::coord_sf(xlim = c(-90.5, -86))
```

#### [**Casos Por Municipio 2023** ]{style="color:#7d9029"}
```{r bump_map_mun_2023}
static_bump_map(dataset = x,
                year = "2023",
                state = FALSE,
                cve_edo = "31",
                country_text_x = .01,
                country_text_y = 0.024,
                axis_start = 1,
                value_text = 0.37,
                size_text_value = 4,
                line_size = 2,
                size_text_country = 4,
                pal_vir = "viridis") +
    ggplot2::coord_sf(xlim = c(-90.5, -86))
```


#### [**Casos por Semana & Jurisdición** ]{style="color:#7d9029"}

```{r casos_semana_jur}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_confirmados.R")
heatmap_confirmados(dataset = x, 
                    year = 2023, 
                    size_text = 3,
                    state = "YUCATAN",
                    JS = TRUE,
                    MPO = TRUE,
                    EDO = FALSE)
```

#### [**Casos por Semana & Municipio**]{style="color:#7d9029"}

```{r casos_semana_mpo}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_confirmados.R")
heatmap_confirmados(dataset = x, 
                    year = 2023, 
                    size_text = 3,
                    state = "YUCATAN",
                    JS = FALSE,
                    MPO = TRUE,
                    EDO = FALSE)
```
:::

</body>
</html>


### [ **Hospitalizados por JS & Municipio** ]{style="color:#7d9029"}

<html>
<head>

```{=html}
<style>
.myDiv1 {
  border: 2px outset darkgreen;
  background-color: darkgreen;
  text-align: center;
}
</style>
```
</head>
<body>

::: myDiv1
<h2>

</h2>

<p>

</p>

#### [**Casos Hospitalizados por Semana & Jurisdición** ]{style="color:#7d9029"}

```{r casos_hospitalizados_semana_jur}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_hospitalizados.R")
heatmap_hospitalizados(dataset = x,
                       year = 2023,
                       size_text = 3,
                       state = "YUCATAN",
                       JS = TRUE)
```

#### [**Casos Hospitalizados por Semana & Municipio**]{style="color:#7d9029"}

```{r casos_hospitalizados_semana_mpo}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/heatmap_hospitalizados.R")
heatmap_hospitalizados(dataset = x,
                       year = 2023,
                       size_text = 3,
                       state = "YUCATAN",
                       JS = FALSE)
```
:::

</body>
</html>


### **Canales Endémicos**

<html>
<head>
<style>
</style>
</head>
<body>
<div >
  <h2></h2>
  <p></p>


#### [**Canal Endémico Jurisdiccional** ]{style="color:#7d9029"}

```{r canel_endemico_jurisdiccional}
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/boldenr/epi_channel_js.R")

epi_channel_js(dataset = x, state = "YUCATAN")

```

#### [**Canal Endémico Municipal** ]{style="color:#7d9029"}

```{r canel_endemico_municipal}
# Step 2. load the function ####
source("~/Library/CloudStorage/Dropbox/r_developments/r_new_functions/3.Functions/boldenr/epi_channel_mpo.R")

# Step 3. apply the function ####

epi_channel_mpo(dataset = x, 
                state = "YUCATAN")

```

</div>
</body>
</html>

### **Casos por Instituciones**

```{r casos_intituciones_yucatan}
library(formattable)
boldenr::tb_conf(x = x,
                 inst = TRUE,
                 year = 2023,
                 state = "YUCATAN")
```

### **Casos por Grupos Etarios**

```{r casos_grupos_etarios_yucatan}
x |>
    dplyr::mutate(age_class = cut(IDE_EDA_ANO,
                                  c(0,1,5,10, 15, 20, 25, 30,
                                    35, 40, 45, 50, 55, 60,65, 
                                    max(IDE_EDA_ANO)),
                                  labels = c("<1", "1-4", "5-9", "10-14",
                                             "15-19", "20-24", "25-29",
                                             "30-34", "35-39", "40-44",
                                             "45-49", "50-54", "55-59",
                                             "60-64", ">65"),
                                  right = FALSE,
                                  include.lowest = TRUE)) |>
    dplyr::filter(ESTATUS_CASO %in% c(2)) |>
    dplyr::filter(ANO %in% c("2023")) |>
    dplyr::filter(DES_EDO_RES %in% c("YUCATAN")) |>
    dplyr::filter(DES_DIAG_FINAL %in% c("DENGUE CON SIGNOS DE ALARMA",
                                        "DENGUE NO GRAVE",
                                        "DENGUE GRAVE")) |>
    dplyr::mutate(IDE_SEX = ifelse(IDE_SEX == 1, "Masculino", "Femenino")) |>
    dplyr::group_by(age_class, IDE_SEX) |>
    dplyr::summarise(count = dplyr::n(), .groups = "drop") |>
apyramid::age_pyramid(age_group = "age_class",
                      split_by = IDE_SEX,
                      show_midpoint = FALSE,
                      proportional = FALSE,
                      pal =  c("#E01E5A", "#2EB67D"),
                      count = count) +
    ggplot2::labs(x = "Grupos Etarios",
                  y = "Número de Casos") +
    ggplot2::theme(legend.direction = "horizontal",
                   legend.position = "bottom",
                   legend.title = ggplot2::element_text(size = 2))
```

# **Vigilancia Entomológica**

## Column {.tabset}

### [ **Ovitrampas** ]{style="color:#660033"}

<html>

<head>

```{=html}
<style>
.myDiv1 {
  border: 2px outset darkgreen;
  background-color: darkgreen;
  text-align: center;
}
</style>
```
</head>

<body>

::: myDiv1
<h2>

</h2>

<p>

</p>

#### [**Áreas Urbanas con Vigilancia Entomológica** ]{style="color:#7d9029"}

```{r vigilancia_entomologica, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center",out.width="90%", cache = TRUE, fig.show = "hold"}
# 1.load the AGEM of veracruz #####
library(magrittr)
library(sf)
mun <- rgeomex::AGEM_inegi19_mx  |>
    dplyr::filter(CVE_ENT == "31")


# Step 2. load the urban localities ####
urb_loc <- rgeomex::loc_inegi19_mx  |>
    dplyr::filter(CVE_ENT == "31")


# Step 3. extract the high risk localities ####

# Step 3.1 load the cenaprece metas ####
x <- readxl::read_xls(path = "1.Datasets/repMetas.xls",
                      sheet = 1, skip = 11)  |>
    dplyr::select(1:2, 7:10, 14, 16)  |>
    dplyr::mutate(cve_mun = stringr::str_sub(MUNICIPIO, start = 1, end = 3),
                  cve_loc = stringr::str_sub(LOCALIDAD, start = 1, end = 4))
# Step 3.2 extract high risk localities 
urb_loc_hr <- urb_loc  |>
    dplyr::filter(CVE_MUN %in% c(x$cve_mun))  |>
    dplyr::filter(CVE_LOC %in% c(x$cve_loc))


# Step 4. extract the localities with ovitraps ####
y <- readxl::read_xls(path = "1.Datasets/repMetas.xls",
                      sheet = 1, skip = 11)  |>
    dplyr::select(1:2, 7:10, 14, 16)  |>
    dplyr::mutate(cve_mun = stringr::str_sub(MUNICIPIO, start = 1, end = 3),
                  cve_loc = stringr::str_sub(LOCALIDAD, start = 1, end = 4))  |>
    dplyr::filter(`CON OVITRAMPAS` == "Sí")
urb_loc_hr_ovi <- urb_loc  |>
    dplyr::filter(CVE_MUN %in% c(y$cve_mun))  |>
    dplyr::filter(CVE_LOC %in% c(y$cve_loc, "0037"))

mapview::mapview(urb_loc_hr,
                 layer.name = "Localidades de Alto Riesgo",
                 col.regions = "#E01E5A",
                 col = "white") +
    mapview::mapview(urb_loc_hr_ovi,
                     layer.name = "Localidades con Ovitrampas",
                     col.regions = "#2EB67D",
                     col = "white")



```

#### [**Indicador de Ovitrampas por Casas**]{style="color:#7d9029"}

```{r indicador_ovitrampas_by_ovitrap, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="80%", fig.show = "hold"}
ovitraps_occupancy_abundancy(ovitraps_path = path_vect,
                             scale = "ovitraps")

```

#### [**Indicador de Ovitrampas por Manzana**]{style="color:#7d9029"}

```{r indicador_ovitrampas_by_blocks, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="50%", fig.show = "hold"}
ovitraps_occupancy_abundancy(ovitraps_path = path_vect,
                             scale = "blocks")
```

#### [ **Manzanas Calientes del Área Urbana de Mérida en la Semana `r lubridate::epiweek(Sys.Date())`**]{style="color:#7d9029"}

```{r manzanas_calientes_merida, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}

# Step 1. load the blocks #####



# Step 1.1 extract the block of yucatan state ####
#x <- rgeomex::blocks_ine20_mx_c
x <- blocks_ine10_mx |> 
  dplyr::filter(ENTIDAD == 31)



# Step 2. hotblocks #####
boldenr::hot_blocks(loc = "Mérida",
                    x = ovis,
                    blocks = x,
                    cve_mpo = "50",
                    sem1 = lubridate::epiweek(Sys.time()),
                    risk = TRUE)



```

#### [**Predicción del Número de Huevos en el área Urbana de Mérida en la semana `r lubridate::epiweek(Sys.Date())`**]{style="color:#7d9029"}

```{r eggs_prediction_merida, echo=FALSE, error=FALSE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}
deneggs::eggs_hotspots(path_lect = path_vect,
                       cve_ent = 31,
                       locality  = "Merida",
                       path_coord = path_coord,
                       longitude  = "Pocision_X",
                       latitude =  "Pocision_Y",
                       aproximation = "gaussian",
                       integration = "eb",
                       fam = "zeroinflatednbinomial1",
                       k = 30,
                       palette_vir  = "magma",
                       leg_title = "Huevos",
                       plot = FALSE,
                       hist_dataset = FALSE, ##### NOTA
                       sem = lubridate::epiweek(Sys.Date()),
                       var = "eggs",
                       cell_size = 2000,
                       alpha = .99)$map
```


#### [ **Manzanas Calientes de Valladolid en la semana `r lubridate::epiweek(Sys.Date())-1`**]{style="color:#7d9029"}

```{r manzanas_calientes_valladolid, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}


# Step 2. load the blocks #####
#load("C:/Users/HOME/OneDrive/automatic_read_ine_2010/8.RData/block_ine10_mx.RData")


# Step 2.1 extract the block of yucatan state ###
#x <- rgeomex::blocks_ine20_mx_c
x <- blocks_ine10_mx |> dplyr::filter(ENTIDAD == 31)

# Step 2. hotblocks #####
boldenr::hot_blocks(loc = "Valladolid",
                    x = ovis,
                    blocks = x,
                    cve_mpo = "102",
                    sem1 = lubridate::epiweek(Sys.time())-1,
                    risk = TRUE)



```

#### [ **Predicción del Número de Huevos en el área urbana de Valladolid en la semana `r lubridate::epiweek(Sys.Date())-1`**]{style="color:#7d9029"}

```{r eggs_prediction_valladolid, echo=FALSE, error=FALSE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}
deneggs::eggs_hotspots(path_lect = path_vect,
                       cve_ent = 31,
                       locality  = "Valladolid",
                       path_coord = path_coord,
                       longitude  = "Pocision_X",
                       latitude =  "Pocision_Y",
                       aproximation = "gaussian",
                       integration = "eb",
                       fam = "zeroinflatednbinomial1",
                       k = 80,
                       palette_vir  = "magma",
                       leg_title = "Huevos",
                       plot = FALSE,
                       hist_dataset = FALSE, ##### NOTA
                       sem = lubridate::epiweek(Sys.Date())-1,
                       var = "eggs",
                       cell_size = 2000,
                       alpha = .99)$map

```


#### [ **Manzanas Calientes de Tizimín en la semana `r lubridate::epiweek(Sys.Date())-1`**]{style="color:#7d9029"}

```{r manzanas_calientes_tizimin, echo=FALSE, error=TRUE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}


# Step 2. load the blocks #####
#load("C:/Users/HOME/OneDrive/automatic_read_ine_2010/8.RData/block_ine10_mx.RData")


# Step 2.1 extract the block of yucatan state ###
#x <- rgeomex::blocks_ine20_mx_c
x <- blocks_ine10_mx |> dplyr::filter(ENTIDAD == 31)

# Step 2. hotblocks #####
boldenr::hot_blocks(loc = "Tizimín",
                    x = ovis,
                    blocks = x,
                    cve_mpo = "96",
                    sem1 = lubridate::epiweek(Sys.time())-1,
                    risk = TRUE)



```

#### [ **Predicción del Número de Huevos en el área urbana de Tizimín en la semana `r lubridate::epiweek(Sys.Date())-1`**]{style="color:#7d9029"}

```{r eggs_prediction_tizimin, echo=FALSE, error=FALSE, message=FALSE,dpi=300, warning=FALSE, fig.align = "center", out.width="90%", fig.show = "hold"}
deneggs::eggs_hotspots(path_lect = path_vect,
                       cve_ent = 31,
                       locality  = "Tizimín",
                       path_coord = path_coord,
                       longitude  = "Pocision_X",
                       latitude =  "Pocision_Y",
                       aproximation = "gaussian",
                       integration = "eb",
                       fam = "zeroinflatednbinomial1",
                       k = 80,
                       palette_vir  = "magma",
                       leg_title = "Huevos",
                       plot = FALSE,
                       hist_dataset = FALSE, ##### NOTA
                       sem = lubridate::epiweek(Sys.Date())-1,
                       var = "eggs",
                       cell_size = 2000,
                       alpha = .99)$map

```


:::

</body>
</html>



# **Acciones de Control**

## Column {.tabset}

# **Cadenas de Transmisión**

## Column {.tabset}


# **Hotspots del Vector**

## Column {.tabset}

# **Mapas del Riesgo de la Transmisión Activa**

## Column {.tabset}




